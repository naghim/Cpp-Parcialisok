#include "malwarecatalog.h"
#include <iostream>
#include <stdexcept>
#include <algorithm>

void MalwareCatalog::addMalware(Malware *m)
{
	if (catalog.find(m->getName()) != catalog.end())
	{
		throw std::runtime_error("[Error] Malware with name '" + m->getName() + "' already exists in the catalog.\n");
	}
	catalog[m->getName()] = m; // ha nem létezik, hozzáadja, ha létezik, felülírná, de ezt már lekezeltük
}

Malware *MalwareCatalog::findByName(const std::string &name)
{
	auto it = catalog.find(name);
	if (it == catalog.end())
	{
		throw std::runtime_error("[Error] Malware with name '" + name + "' is not found in the catalog.\n");
	}
	return it->second;
}

std::vector<Malware *> MalwareCatalog::findByType(const std::string &type)
{
	std::vector<Malware *> results;
	for (const auto &[key, value] : catalog)
	{
		if (value->getType() == type)
		{
			results.push_back(value);
		}
	}
	return results;
}

void MalwareCatalog::printCatalog() const
{
	for (const auto &[key, value] : catalog)
	{
		std::cout << *value << "\n\t--- \n";
	}
}

std::vector<std::pair<std::string, Malware *>> MalwareCatalog::sortByThreatLevelDesc() const
{
	// átalakítjuk a mapet egy vectorrá, hogy rendezni tudjuk
	std::vector<std::pair<std::string, Malware *>> vec(catalog.begin(), catalog.end());

	// rendezés csökkenő sorrendben a veszélyességi szint alapján
	std::sort(vec.begin(), vec.end(),
			  [](const auto &a, const auto &b)
			  {
				  return a.second->getThreatLevel() > b.second->getThreatLevel();
			  });

	return vec;
}

MalwareCatalog::~MalwareCatalog()
{
	for (const auto &[key, value] : catalog)
	{
		delete value;
	}
}